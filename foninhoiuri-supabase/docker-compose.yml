version: '3.8'

services:
  auth:
    image: supabase/gotrue:v2.176.1
    restart: unless-stopped
    ports:
      - 8001:8000
    environment:
      API_EXTERNAL_URL: http://supabase.umbrel.local # URL externa para o umbrelOS
      DB_URL: postgresql://default:default@postgres:5432/supabase
      JWT_SECRET: changesupersecretjwtwith32chars! # ğŸ” ALTERE: use uma string aleatÃ³ria com no mÃ­nimo 32 caracteres
      SUPABASE_URL: http://${DEVICE_DOMAIN_NAME}:3000
      DISABLE_SIGNUP: "false" # ğŸš« VocÃª pode definir como "true" para desativar registros pÃºblicos

  storage:
    image: supabase/storage-api:latest
    restart: unless-stopped
    ports:
      - 8002:5000
    environment:
      DB_URL: postgresql://default:default@postgres:5432/supabase
      JWT_SECRET: changesupersecretjwtwith32chars! # ğŸ” MANTENHA igual ao JWT usado nos outros serviÃ§os
      STORAGE_BACKEND: s3 # â˜ï¸ ALTERE para "file" se nÃ£o for usar S3
      GLOBAL_S3_BUCKET: my-supabase-bucket # ğŸ“¦ ALTERE: nome do bucket na AWS
      STORAGE_S3_REGION: us-east-1 # ğŸŒ ALTERE: regiÃ£o onde seu bucket S3 estÃ¡ hospedado
      AWS_ACCESS_KEY_ID: myawsaccesskeyid # ğŸ”‘ ALTERE: sua chave de acesso da AWS
      AWS_SECRET_ACCESS_KEY: myawssecretaccesskey # ğŸ” ALTERE: seu segredo da AWS
      FILE_SIZE_LIMIT: 52428800
    volumes:
      - ${APP_DATA_DIR}/data/storage:/var/log/supabase/storage

  rest:
    image: postgrest/postgrest:latest
    restart: unless-stopped
    ports:
      - 8003:3000
    environment:
      PGRST_DB_URI: postgresql://default:default@postgres:5432/supabase
      PGRST_JWT_SECRET: changeme-supersecretjwtwith32chars! # ğŸ” MANTENHA igual ao dos outros serviÃ§os
      PGRST_DB_SCHEMA: public,storage,auth,extensions # ğŸ“‚ ALTERE se usar schemas personalizados
      PGRST_DB_ANON_ROLE: anon # ğŸ‘¤ ALTERE se quiser outro role default para acesso anÃ´nimo
      PGRST_DB_PREFER_RATIO: "1.5" # Exemplo, ajuste conforme necessÃ¡rio
      # Adicione outras variÃ¡veis de ambiente do PostgREST conforme necessÃ¡rio

  realtime:
    image: supabase/realtime:latest
    restart: unless-stopped
    ports:
      - 8004:4000
    environment:
    # VariÃ¡veis de ambiente ESSENCIAIS
      APP_NAME: realtime
      PORT: 4000
      NODE_ENV: production
      DB_URL: postgresql://default:default@postgres:5432/supabase
      JWT_SECRET: changeme-supersecretjwtwith32chars! # ğŸ” MESMA JWT para autenticaÃ§Ã£o
      REDIS_URL: redis://redis:6379 # âš ï¸ Confirme o ID/nome do seu Redis no Umbrel
      # Ajuste RLIMIT_NOFILE se necessÃ¡rio, ou remova se o problema for no script de inicializaÃ§Ã£o da imagem
      # Se o problema for na imagem do Docker, pode ser necessÃ¡rio construir uma imagem customizada
      # ou verificar se hÃ¡ uma variÃ¡vel de ambiente equivalente para o limite de arquivos.
      # Por enquanto, vou supor que o erro RLIMIT_NOFILE vem de um script interno da imagem.

  studio:
    image: supabase/studio:latest
    restart: unless-stopped
    ports:
      - 8000:3000
    environment:
      SUPABASE_URL: http://supabase-rest:3000 # ğŸŒ ALTERE se o domÃ­nio mudar
      SUPABASE_ANON_KEY: anon_key_generated_from_jwt # ğŸ”‘ ALTERE: gere baseado no JWT real
      #SUPABASE_SERVICE_ROLE_KEY: service_role_key_generated # ğŸ”‘ ALTERE: gere baseado no JWT real
      #OPENAI_API_KEY: "" # ğŸ¤– Opcional: insira sua chave da OpenAI se usar recursos com IA
